<!--

    THIS CODE AND INFORMATION ARE PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED WARRANTIES OF MERCHANTABILITY AND/OR FITNESS
    FOR A PARTICULAR PURPOSE. THIS CODE AND INFORMATION ARE NOT SUPPORTED BY XEBIALABS.

-->
<synthetic
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns="http://www.xebialabs.com/deployit/synthetic"
	xsi:schemaLocation="http://www.xebialabs.com/deployit/synthetic synthetic.xsd">

    <!-- CONTAINERS -->

	<type type="azure.Subscription" extends="udm.BaseContainer" description="Azure Subscription account" root="INFRASTRUCTURE">
		<!-- public -->
		<property name="subscriptionId" description="Subscription Id"/>
		<property name="tenantId" description="Tenant Id"/>
		<property name="clientId" description="Client Id"/>
		<property name="clientKey" password="true" description="Client Key"/>
        <property name="ftpUser" description="Ftp user"/>
        <property name="ftpPassword" password="true" description="Ftp password"/>


        <!-- hidden -->
		<property name="azureBaseURL" hidden="true" description="Base URL to access Azure Services" default="https://management.azure.com/"/>
		<property name="azureManagementURL" hidden="true" description="Azure Management API End Point"  default="https://management.core.windows.net/"/>
		<property name="azureActiveDirectoryURL" hidden="true" description="Azure Active Directory URL for Authentication" default="https://login.windows.net/"/>

        <!-- control tasks -->
        <method name="checkConnection" label="check connection" delegate="jythonScript" script="azure_app_services/check_connection.py"/>
	</type>

	<type type="azure.ResourceGroup" extends="udm.BaseContainer">
        <!-- public -->
		<property name="subscription" kind="ci" referenced-type="azure.Subscription" as-containment="true"/>
		<property name="resourceName" />
		<property name="resourceLocation" description="Available locations are 'centralus, eastasia, southeastasia, eastus, eastus2, westus, westus2, northcentralus, southcentralus, westcentralus, northeurope, westeurope, japaneast, japanwest, brazilsouth, australiasoutheast, australiaeast, westindia, southindia, centralindia, canadacentral, canadaeast, uksouth, ukwest'." />
		<property name="resourceTags" kind="map_string_string" required="false" />

        <!-- control tasks -->
		<method name="create" delegate="jythonScript" script="azure_app_services/define_resource_group.py"/>
        <method name="remove" delegate="jythonScript" script="azure_app_services/remove_resource_group.py"/>
	</type>


    <!-- DEPLOYEDS -->

    <type type="azure.BaseAppServiceDeployed" extends="udm.BaseDeployed" container-type="azure.ResourceGroup" virtual="true">
        <property name="forceRedeploy" kind="boolean" transient="true" required="false" default="false" category="Redeploy"/>
    </type>

    <type type="azure.BaseArtifactAppServiceDeployed" extends="udm.BaseDeployedArtifact" container-type="azure.ResourceGroup" virtual="true">
        <property name="forceRedeploy" kind="boolean" transient="true" required="false" default="false" category="Redeploy"/>
    </type>

    <type type="azure.AppServicePlan" extends="azure.BaseAppServiceDeployed" deployable-type="azure.AppServicePlanSpec">
		<generate-deployable type="azure.AppServicePlanSpec" extends="udm.BaseDeployable"/>
		<property name="servicePlanName"/>
		<property name="location" description="The location of the service plan" />
		<property name="sku" kind="enum" enum-class="com.microsoft.azure.management.websites.models.SkuOptions" default="Basic"  description="Web Hosting Plan SKU options."/>
		<property name="workerSize" kind="enum" enum-class="com.microsoft.azure.management.websites.models.WorkerSizeOptions" default="Small" description="The instance size. Possible values are Small, Medium, or Large."/>
	</type>

    <type type="azure.WebAppModule" extends="azure.BaseArtifactAppServiceDeployed" deployable-type="azure.WebApp">
        <generate-deployable type="azure.WebApp" extends="udm.BaseDeployableFileArtifact" />
        <property name="appName" description="The name of the webapp to create"/>
        <property name="plan" description="the name of the app service plan eg: Default1."/>
        <property name="appSettings" kind="map_string_string" required="false" category="App Settings" />
        <property name="connectionName" required="false" category="DB Connection" />
        <property name="connectionValue" required="false" category="DB Connection" />
        <property name="connectionType" kind="enum" enum-class="com.microsoft.azure.management.websites.models.DatabaseServerType" default="SQLAzure" category="DB Connection" />
    </type>

	<type type="azure.TriggeredWebJobModule" extends="azure.BaseArtifactAppServiceDeployed" deployable-type="azure.TriggeredWebJob">
		<generate-deployable type="azure.TriggeredWebJob" extends="udm.BaseDeployableFileArtifact" />
		<property name="webJobName" description="The name of the web job"/>
		<property name="executableFileName" description="The name of the file in the web job zip that must be executed"/>
		<property name="appName" description="The name of the webapp"/>
		<property name="schedule" required="false" description="cron expression made of 6 fields (second, minute, hour, day, month, day of the week)"/>
	</type>



</synthetic>
